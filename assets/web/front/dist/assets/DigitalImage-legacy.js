System.register(["./index-legacy.js","./ChatTop-legacy.js","./global-legacy.js"],(function(e,a){"use strict";var t,l,o,n,i,s,u,v,r,c,d,p,g,h,m,y,w,f,b,x,S,k,A,C,T,D,R,L,P,I=document.createElement("style");return I.innerHTML='@charset "UTF-8";[data-v-2e160273]::selection{color:inherit}video[data-v-2e160273] ::selection{background:none}.main-content[data-v-2e160273]{position:relative;display:flex;flex-direction:column;height:100vh;width:100vw;overflow:hidden;color:var(--uosai-color-shortcut);font-family:SourceHanSansSC-Medium;font-size:16px}.main-content .logo[data-v-2e160273]{margin:5px auto 0;text-align:center;width:110px}.main-content .logo img[data-v-2e160273]{width:100%}.main-content .logo div[data-v-2e160273]{font-size:20px;font-family:Source Han Sans SC;font-weight:700;margin-top:7px}.main-content .close[data-v-2e160273]{width:12px;height:12px;position:absolute;right:7px;top:7px;padding:12px}.main-content .close[data-v-2e160273]:hover{cursor:pointer}.main-content .play[data-v-2e160273]{width:36px;height:36px;position:absolute;bottom:7.86vh;left:12.75vw;padding:5px;fill:var(--uosai-color-clear);color:var(--uosai-color-clear);z-index:20}.main-content .play[data-v-2e160273]:not(.disabledDig):hover{cursor:pointer;fill:var(--uosai-color-clear-hover);color:var(--uosai-color-clear-hover)}.main-content .play[data-v-2e160273]:not(.disabledDig):active{fill:var(--activityColor);color:var(--activityColor)}.main-content .play.disabledDig[data-v-2e160273]{fill:var(--uosai-color-inputcontent-placeholder);color:var(--uosai-color-inputcontent-placeholder)}.main-content .animate-box[data-v-2e160273]{position:absolute;width:300px;height:300px;text-align:center;z-index:1;left:50%;transform:translate(-50%);top:40%}.main-content .animate-box[data-v-2e160273]:hover{cursor:pointer}.main-content .animate-box .listen[data-v-2e160273]{position:absolute;display:flex;justify-content:center;width:100%;height:auto;left:0}.main-content .animate-box .listen img[data-v-2e160273]{width:100%;height:auto}.main-content .animate-box video[data-v-2e160273]{position:absolute;width:100%;height:auto;z-index:1;left:0}.main-content .scale[data-v-2e160273]{position:absolute;width:300px;left:0;animation:scale-2e160273 50ms linear;animation-fill-mode:forwards}.main-content .scale1[data-v-2e160273]{position:absolute;width:300px;left:0;animation:scale1-2e160273 50ms linear;animation-fill-mode:forwards}.main-content .rotate[data-v-2e160273]{transform-origin:center center;animation:rotate-2e160273 6s linear infinite}.main-content .active-box[data-v-2e160273]{width:100%;margin:0 auto 6.12vh;left:0;text-align:center;font-family:Source Han Sans SC;font-size:20px;z-index:10}.main-content .active-box .pr[data-v-2e160273]{position:relative}.main-content .active-box .active-con .dian[data-v-2e160273]{letter-spacing:1.5px;margin-left:0;display:inline-block}.main-content .active-box .active-con pre[data-v-2e160273]{word-break:break-all;white-space:pre-wrap;line-height:25px;width:80vw;margin:auto;font-size:14px}.main-content .active-box .active-con .go-config[data-v-2e160273]{font-size:14px;color:var(--activityColor);cursor:pointer;text-decoration:none}.main-content .active-box .active-con svg[data-v-2e160273]{width:10px;height:14px;margin-right:8px}.main-content .active-box .active-con .fz-14[data-v-2e160273]{font-size:14px;margin-top:5px}.main-content .active-box .handel[data-v-2e160273]{position:relative;width:70px;height:70px;margin:14.6vh auto 0}.main-content .active-box .handel .svgBg[data-v-2e160273]{width:70px;height:70px;background:var(--activityColor);border-radius:50%;display:flex;justify-content:center;align-items:center}.main-content .active-box .handel .svgBg-hover[data-v-2e160273]{width:70px;height:70px;position:absolute;top:0;background:rgba(255,255,255,.1);border-radius:50%;display:none}.main-content .active-box .handel .icon-dig-play[data-v-2e160273]{width:18px;height:20px}.main-content .active-box .handel .icon-dig-stop[data-v-2e160273]{width:16px;height:16px}.main-content .disabledDig[data-v-2e160273]{cursor:not-allowed}.main-content[data-v-2e160273] .icon-change-normal{fill:var(--activityColor)!important}@keyframes scale-2e160273{0%{transform:scale(1)}to{transform:scale(var(--scale))}}@keyframes scale1-2e160273{0%{transform:scale(1)}to{transform:scale(var(--scale1))}}@keyframes rotate-2e160273{0%{transform:rotate(0)}50%{transform:rotate(180deg)}to{transform:rotate(360deg)}}.handel[data-v-2e160273]:not(.disabledDig):hover{cursor:pointer}.handel:not(.disabledDig):hover>.svgBg-hover[data-v-2e160273]{display:block}.handel:not(.disabledDig):active>.svgBg-hover[data-v-2e160273]{background:rgba(255,255,255,.05);display:block}.handel:not(.disabledDig):active .svg-icon[data-v-2e160273]{opacity:.6}.handel.disabledDig .svgBg[data-v-2e160273]{opacity:.4}.dark .handel:not(.disabledDig):hover>.svg-icon[data-v-2e160273]{display:block;background:rgba(255,255,255,.1)}.dark .handel:not(.disabledDig):active>.svgBg-hover[data-v-2e160273]{background:rgba(255,255,255,.05);display:block}\n',document.head.appendChild(I),{setters:[e=>{t=e.$,l=e.g,o=e.u,n=e.r,i=e.e,s=e.l,u=e.k,v=e.p,r=e.o,c=e.c,d=e.M,p=e.a,g=e.I,h=e.E,m=e.F,y=e.G,w=e.a1,f=e.P,b=e.j,x=e.Q,S=e.a3,k=e.a4,A=e.a2},e=>{C=e.C,T=e.T,D=e.e,R=e._},e=>{L=e.u,P=e.Q}],execute:function(){const I=""+new URL("silence.webm",a.meta.url).href,E=""+new URL("listen2.png",a.meta.url).href,M=""+new URL("listen1.png",a.meta.url).href,q=""+new URL("listen.webm",a.meta.url).href,z=""+new URL("thinking.webm",a.meta.url).href,B=""+new URL("play.webm",a.meta.url).href,O=""+new URL("error.webm",a.meta.url).href,U=e=>(S("data-v-2e160273"),e=e(),k(),e),j={class:"",style:{position:"relative",flex:"1 1 0"}},N=U((()=>p("div",{class:"logo"},[p("img",{src:R,class:""}),p("div",null,"UOS AI")],-1))),F=[U((()=>p("source",{src:I,type:"video/webm"},null,-1)))],J={class:"listen"},H=[U((()=>p("div",{class:"scale"},[p("img",{src:E,class:"listen-img rotate"})],-1))),U((()=>p("div",{class:"scale1"},[p("img",{src:M,class:"listen-img rotate"})],-1)))],W=[U((()=>p("source",{src:q,type:"video/webm"},null,-1)))],_=[U((()=>p("source",{src:z,type:"video/webm"},null,-1)))],Q=[U((()=>p("source",{src:B,type:"video/webm"},null,-1)))],G=[U((()=>p("source",{src:O,type:"video/webm"},null,-1)))],K={class:"active-box"},$={class:"active-con"},V={key:0,ref:"target"},X={key:1},Y={class:"dian"},Z={key:0,class:"fz-14"},ee={class:"svgBg"},ae=U((()=>p("div",{class:"svgBg-hover"},null,-1))),te={class:"svgBg"},le=U((()=>p("div",{class:"svgBg-hover"},null,-1)));e("default",t({__name:"DigitalImage",setup(e){const{chatQWeb:a,updateActivityColor:t,updateTheme:S}=L(),k=L();l();const R=o(),I=n(1),E=n(1),M=n(2),q=n(!1),z=n(""),B=n(!1),O=n(!1),U=n(""),oe=n(!1),ne=n(!1),ie=n(2),se=i((()=>2==M.value||3==M.value||4==M.value||7==M.value?L().loadTranslations.Stop:L().loadTranslations.Activate)),ue=n("top-right"),ve=i((()=>{switch(M.value){case 1:return[L().loadTranslations.Sleeping,L().loadTranslations["Click on the animation or Ctrl+Super+C to activate"]];case 2:default:return[L().loadTranslations.Listening,L().loadTranslations["Click the animation or press Enter to send"]];case 3:return[L().loadTranslations.Thinking,L().loadTranslations["Click animation to interrupt"]];case 4:return[L().loadTranslations.Answering,L().loadTranslations["Click animation to interrupt"]];case 5:return L().loadTranslations["Connection failed, please check the network."];case 6:return L().loadTranslations["Microphone not detected"];case 7:return L().loadTranslations["Stop recording after %1 seconds"].replace("%1",ke.value);case 8:case 9:return pe.value;case 10:return L().loadTranslations["Sound output device not detected"]}})),re=n([]),ce=n([]),de=n(""),pe=n(""),ge=n(!1),he=n(!1);let me=null;const ye=()=>{me&&clearTimeout(me),me=setTimeout((()=>{he.value=!0}),2e3)},we=()=>{me&&clearTimeout(me),he.value=!1};let fe=0,be=null;const xe=()=>{console.log("startCounter-------"),be=setInterval((()=>{fe++,console.log("startCounter",fe,z.value.trim().length),2==fe&&0!==z.value.trim().length?(console.log("5count","startCounter",fe),Ee()):10==fe&&(console.log("10count",fe),Ee(),M.value=1)}),1e3)},Se=()=>{console.log("stopCounter------"),be&&(clearInterval(be),be=null,fe=0)},ke=n(0),Ae=n(!1),Ce=async()=>{if(console.log(999,"handleRecorder",Ae.value,ge.value,B.value),B.value&&!ge.value)return Ae.value?Ee():void(Ae.value||(B.value=await P(a.isAudioInputAvailable),await P(a.stopPlayTextAudio),B.value&&(console.log("startRecorder-------"),await P(a.startRecorder),Ae.value=!0,U.value="")))},Te=n(""),De=async()=>{if(console.log("sendQuestion",z.value),0===z.value.trim().length||ne.value)return void(z.value="");await P(a.stopPlayTextAudio),U.value="",Ae.value&&Ee(),Se(),re.value.push({role:"user",content:z.value});const{id:e,model:t,icon:l,llmname:o}=de.value,n=await P(a.sendAiRequest,e||"",t||"",1,z.value,2);re.value.push({role:"assistant",anwsers:[{content:"",talkID:n,status:0,type:0,llmIcon:l,llmName:o}]}),Te.value=n,ge.value=!0,z.value="",6!==M.value&&10!==M.value&&(M.value=3)},Re=e=>{if(!q.value)if(console.log("activeFun",M.value,e),2==M.value||7==M.value){if(e&&0!==z.value.trim().length)return void Ee();Ee(),M.value=1}else 3==M.value?(qe(),M.value=1):4==M.value?(M.value=1,Ie()):1!=M.value&&9!=M.value||(M.value=2,Ae.value=!1)},Le=()=>{if(2==M.value)oe.value=!0,0===z.value.trim().length?(Ae.value=!1,P(a.stopRecorder),Se(),R.push("/chat")):Ee();else{if(3==M.value||4==M.value)return;Se(),R.push("/chat")}},Pe=async e=>{const{content:t,talkID:l}=D.last(re.value).anwsers[0];await P(a.playTextAudio,l,e||t,!0),U.value=l},Ie=async()=>{await P(a.stopPlayTextAudio),U.value=""},Ee=async(e,t)=>{console.log("sigAudioASRError",e,t),Ae.value=!1,await P(a.stopRecorder),e&&oe.value&&R.push("/chat"),e&&6!==M.value&&(M.value=9,pe.value=t)},Me=e=>{console.log("sigPlayTTSFinished",e),U.value===e&&(U.value=""),5!==M.value&&6!==M.value&&8!==M.value&&9!==M.value&&(M.value=1),ge.value=!1},qe=async()=>{await P(a.cancelAiRequest,Te.value);const e=re.value[re.value.length-2].content,{type:t,content:l}=D.last(D.last(re.value).anwsers),{icon:o,displayname:n}=de.value;P(a.logAiChatRecord,Te.value,e,l,!1,0,"",t,o||"",n||""),ge.value=!1,Se()};s((()=>M.value),(e=>{ie.value=e,console.log("watch",e),1==e?(a&&a.playSystemSound&&P(a.playSystemSound,1),Ie(),Se(),ge.value=!1):2==e?(a&&a.playSystemSound&&P(a.playSystemSound,0),ge.value=!1,Ae.value=!1,Ce(),xe()):Se(),4==e&&ne.value&&Ie(),5==e||6==e||8==e||10==e?(document.querySelector(".video5")&&(document.querySelector(".video5").currentTime=0,document.querySelector(".video5").play()),q.value=!0):9==e?(document.querySelector(".video5")&&(document.querySelector(".video5").currentTime=0,document.querySelector(".video5").play()),q.value=!1):(document.querySelector(".video5")&&document.querySelector(".video5").pause(),q.value=!1)}),{deep:!0,immediate:!1});const ze={sigAiReplyStream:(e,t,l)=>{if(console.log({type:e,value:t,status:l}),0===l?D.last(D.last(re.value).anwsers).content=D.last(D.last(re.value).anwsers).content+t:200===l?(D.last(D.last(re.value).anwsers).status=l,Pe(),6!==M.value&&10!==M.value&&(M.value=4)):(D.last(D.last(re.value).anwsers).content=t,D.last(re.value).status=l,D.last(D.last(re.value).anwsers).status=l),0!==l){const e=re.value[re.value.length-2].content,{type:t,content:o}=D.last(D.last(re.value).anwsers);l<0&&(-9002===l||-9e3===l||-9001===l?(pe.value=o,M.value=8):M.value=4,Pe());const{icon:n,displayname:i}=de.value;P(a.logAiChatRecord,Te.value,e,o,!1,l,"",t,n||"",i||"")}},sigAudioASRStream:(e,a)=>{console.log("sigAudioASRStream",e,a),z.value=e,""!==e&&(Se(),2==M.value&&xe()),a&&oe.value?(Se(),R.push("/chat")):a&&1!==M.value&&10!==M.value&&De()},sigAudioASRError:Ee,sigAudioCountDown:e=>{ke.value=e,ke.value>0?M.value=7:Ee()},sigPlayTTSFinished:Me,sigPlayTTSError:e=>U.value="",sigActiveColorChanged:e=>t(e),sigAudioInputDevChange:e=>{console.log("sigAudioInputDevChange"),B.value=e,e||(Ae.value=!1),e?O.value?M.value=1:M.value=10:M.value=6},sigAudioSampleLevel:e=>{const a=1+e/100*.7,t=1+e/100*1.2;I.value=a,E.value=t},sigNetStateChanged:e=>{e?M.value=1:(2==M.value&&Ee(),3==M.value&&qe(),4==M.value&&Ie(),M.value=5)},sigText2PicFinish:(e,t)=>{D.last(D.last(re.value).anwsers).content=JSON.stringify(t);const l=re.value[re.value.length-2].content,o=D.last(D.last(re.value).anwsers).type,n=D.last(D.last(re.value).anwsers).status;console.log(Te.value,l,t,0,"",o,n);const{icon:i,displayname:s}=de.value;P(a.logAiChatRecord,Te.value,l,JSON.stringify(t),!1,0,"",o,i||"",s||""),ge.value=!1,n>=0&&2===o&&t&&(Pe(L().loadTranslations["The picture has been generated, please switch to the chat interface to view it."]),6!==M.value&&10!==M.value&&(M.value=4))},sigChatConversationType:(e,a)=>{D.last(D.last(re.value).anwsers).type=a},sigWebchat2BeHiden:()=>{ne.value=!0,2==M.value&&(Ee(),M.value=1),4==M.value&&Ie()},sigWebchat2BeShowed:async()=>{ne.value=!1,1==M.value&&(M.value=2),4==M.value&&(Me(),M.value=2)},sigThemeChanged:e=>{S(e)},llmAccountLstChanged:(e,a)=>{console.log(6555,e,a);const t=JSON.parse(a),l=t.findIndex((e=>e.id===de.value.id));e!==de.value.id&&0!==t.length&&5!==M.value&&6!==M.value&&(M.value=1),e||(de.value={}),l>-1?(t[l].active=!0,de.value=t[l]):t.forEach((a=>{a.id===e&&(a.active=!0,de.value=a)})),ce.value=t},sigDigitalModeActive:()=>{1==M.value&&(M.value=2)},sigAudioOutputDevChanged:async e=>{O.value=e,e?B.value?M.value=1:M.value=6:(U.value="",2==M.value||7==M.value?await P(a.stopRecorder):3==M.value?qe():4==M.value&&Ie(),M.value=10)},sigWebchatModalityChanged:e=>(e=>{let a=document.querySelector("#drop-mask");a||(a=document.createElement("div"),a.id="drop-mask",document.body.appendChild(a)),a.style.height="100vh",a.style.width="100vw",a.style.display=e?"flex":"none"})(e)};function Be(e){"Enter"===e.key&&(e.stopPropagation(),e.preventDefault(),console.log("handleEnterKey",z.value),0!==z.value.trim().length&&Ee())}return u((async()=>{for(const e in ze)Object.hasOwnProperty.call(ze,e)&&a[e].connect(ze[e]);document.addEventListener("keydown",Be),(async()=>{const e=await P(a.getAiChatRecords,!1),t=await P(a.queryLLMAccountList),l=await P(a.currentLLMAccountId);B.value=await P(a.isAudioInputAvailable),O.value=await P(a.isAudioOutputAvailable),re.value=JSON.parse(e);const o=await P(a.isNetworkAvailable);if(t){const e=JSON.parse(t);e.forEach((e=>{e.id===l&&(e.active=!0,de.value=e)})),ce.value=e}o?B.value?O.value?(a.playSystemSound&&P(a.playSystemSound,0),Ce(),xe()):M.value=10:M.value=6:M.value=5})(),L().loadTranslations=await P(a.loadTranslations)})),v((()=>{for(const e in ze)Object.hasOwnProperty.call(ze,e)&&a[e].disconnect(ze[e]);document.removeEventListener("keydown",Be)})),(e,t)=>{const l=A;return r(),c("div",{class:"main-content",style:x({"--scale":I.value,"--scale1":E.value})},[d(C,{historyLength:re.value.length,playAudioID:U.value,"onUpdate:playAudioID":t[0]||(t[0]=e=>U.value=e),recording:Ae.value,showStop:ge.value,videoStatus:M.value,localmodel:1e3===de.value.model,onSigAudioASRError:Ee,onRouteJump:Le},null,8,["historyLength","playAudioID","recording","showStop","videoStatus","localmodel"]),p("div",j,[N,p("div",{class:g(["animate-box",{disabledDig:q.value}]),onClick:t[11]||(t[11]=e=>Re(!0))},[ne.value?y("",!0):h((r(),c("video",{key:0,autoplay:"",loop:"",muted:"",class:"video1",onPlay:t[1]||(t[1]=e=>1==ie.value&&!ne.value),onPause:t[2]||(t[2]=e=>1!==ie.value||ne.value)},F,544)),[[m,1==M.value]]),h(p("div",J,H,512),[[m,2==M.value||7==M.value]]),ne.value?y("",!0):h((r(),c("video",{key:1,autoplay:"",loop:"",muted:"",class:"video2",onPlay:t[3]||(t[3]=e=>!ne.value&&(2==ie.value||7==ie.value)),onPause:t[4]||(t[4]=e=>2!==ie.value&&7!==ie.value||ne.value)},W,544)),[[m,2==M.value||7==M.value]]),ne.value?y("",!0):h((r(),c("video",{key:2,autoplay:"",loop:"",muted:"",class:"video3",onPlay:t[5]||(t[5]=e=>3==ie.value&&!ne.value),onPause:t[6]||(t[6]=e=>3!==ie.value||ne.value)},_,544)),[[m,3==M.value]]),ne.value?y("",!0):h((r(),c("video",{key:3,autoplay:"",loop:"",muted:"",class:"video4",onPlay:t[7]||(t[7]=e=>4==ie.value&&!ne.value),onPause:t[8]||(t[8]=e=>4!==ie.value||ne.value)},Q,544)),[[m,4==M.value]]),ne.value?y("",!0):h((r(),c("video",{key:4,autoplay:"",muted:"",class:"video5",onPlay:t[9]||(t[9]=e=>!ne.value&&(5==ie.value||6==ie.value||8==ie.value||9==ie.value||10==ie.value)),onPause:t[10]||(t[10]=e=>5!==ie.value&&6!==ie.value&&8!==ie.value&&9!==ie.value&&10!==ie.value||ne.value)},G,544)),[[m,5==M.value||6==M.value||8==M.value||9==M.value||10==M.value]])],2)]),p("div",K,[p("div",$,[8==M.value?(r(),c("pre",V,[w(f(b(ve)),1),p("span",{class:"go-config",href:"#",onClick:t[12]||(t[12]=e=>b(P)(b(a).launchLLMConfigWindow,!0))}," "+f(b(k).loadTranslations["Go to configuration"])+" >",1)],512)):(r(),c("div",X,[h(d(l,{icon:"voice"},null,512),[[m,2==M.value]]),w(f(Array.isArray(b(ve))?b(ve)[0]:b(ve))+" ",1),h(p("span",Y,"...",512),[[m,1==M.value||2==M.value||3==M.value||4==M.value]]),Array.isArray(b(ve))?(r(),c("div",Z,f(b(ve)[1]),1)):y("",!0)]))]),2==M.value||3==M.value||4==M.value||7==M.value?(r(),c("div",{key:0,class:g(["handel",{disabledDig:q.value}]),onMouseenter:t[13]||(t[13]=e=>ye()),onMouseleave:t[14]||(t[14]=e=>we()),onClick:t[15]||(t[15]=e=>Re())},[p("div",ee,[d(l,{icon:"dig-stop"})]),ae,h(d(T,{tip:b(se),class:g(ue.value)},null,8,["tip","class"]),[[m,he.value]])],34)):(r(),c("div",{key:1,class:g(["handel",{disabledDig:q.value}]),onClick:t[16]||(t[16]=e=>Re()),onMouseenter:t[17]||(t[17]=e=>ye()),onMouseleave:t[18]||(t[18]=e=>we())},[p("div",te,[d(l,{icon:"dig-play"})]),le,h(d(T,{tip:b(se),class:g(ue.value)},null,8,["tip","class"]),[[m,he.value]])],34))])],4)}}},[["__scopeId","data-v-2e160273"]]))}}}));
