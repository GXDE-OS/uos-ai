import{$ as e,g as a,u as l,r as t,e as u,l as s,k as o,p as n,o as v,c as i,M as r,a as c,I as d,E as p,F as g,G as y,a1 as m,P as h,j as w,Q as S,a3 as A,a4 as f,a2 as T}from"./index.js";import{C,T as k,e as b,_ as R}from"./ChatTop.js";import{u as L,Q as P}from"./global.js";const I=""+new URL("silence.webm",import.meta.url).href,D=""+new URL("listen2.png",import.meta.url).href,E=""+new URL("listen1.png",import.meta.url).href,q=""+new URL("listen.webm",import.meta.url).href,x=""+new URL("thinking.webm",import.meta.url).href,O=""+new URL("play.webm",import.meta.url).href,M=""+new URL("error.webm",import.meta.url).href,U=e=>(A("data-v-2e160273"),e=e(),f(),e),N={class:"",style:{position:"relative",flex:"1 1 0"}},j=U((()=>c("div",{class:"logo"},[c("img",{src:R,class:""}),c("div",null,"UOS AI")],-1))),B=[U((()=>c("source",{src:I,type:"video/webm"},null,-1)))],J={class:"listen"},F=[U((()=>c("div",{class:"scale"},[c("img",{src:D,class:"listen-img rotate"})],-1))),U((()=>c("div",{class:"scale1"},[c("img",{src:E,class:"listen-img rotate"})],-1)))],W=[U((()=>c("source",{src:q,type:"video/webm"},null,-1)))],_=[U((()=>c("source",{src:x,type:"video/webm"},null,-1)))],Q=[U((()=>c("source",{src:O,type:"video/webm"},null,-1)))],G=[U((()=>c("source",{src:M,type:"video/webm"},null,-1)))],z={class:"active-box"},H={class:"active-con"},K={key:0,ref:"target"},$={key:1},V={class:"dian"},X={key:0,class:"fz-14"},Y={class:"svgBg"},Z=U((()=>c("div",{class:"svgBg-hover"},null,-1))),ee={class:"svgBg"},ae=U((()=>c("div",{class:"svgBg-hover"},null,-1))),le=e({__name:"DigitalImage",setup(e){const{chatQWeb:A,updateActivityColor:f,updateTheme:R}=L(),I=L();a();const D=l(),E=t(1),q=t(1),x=t(2),O=t(!1),M=t(""),U=t(!1),le=t(!1),te=t(""),ue=t(!1),se=t(!1),oe=t(2),ne=u((()=>2==x.value||3==x.value||4==x.value||7==x.value?L().loadTranslations.Stop:L().loadTranslations.Activate)),ve=t("top-right"),ie=u((()=>{switch(x.value){case 1:return[L().loadTranslations.Sleeping,L().loadTranslations["Click on the animation or Ctrl+Super+C to activate"]];case 2:default:return[L().loadTranslations.Listening,L().loadTranslations["Click the animation or press Enter to send"]];case 3:return[L().loadTranslations.Thinking,L().loadTranslations["Click animation to interrupt"]];case 4:return[L().loadTranslations.Answering,L().loadTranslations["Click animation to interrupt"]];case 5:return L().loadTranslations["Connection failed, please check the network."];case 6:return L().loadTranslations["Microphone not detected"];case 7:return L().loadTranslations["Stop recording after %1 seconds"].replace("%1",Ce.value);case 8:case 9:return pe.value;case 10:return L().loadTranslations["Sound output device not detected"]}})),re=t([]),ce=t([]),de=t(""),pe=t(""),ge=t(!1),ye=t(!1);let me=null;const he=()=>{me&&clearTimeout(me),me=setTimeout((()=>{ye.value=!0}),2e3)},we=()=>{me&&clearTimeout(me),ye.value=!1};let Se=0,Ae=null;const fe=()=>{console.log("startCounter-------"),Ae=setInterval((()=>{Se++,console.log("startCounter",Se,M.value.trim().length),2==Se&&0!==M.value.trim().length?(console.log("5count","startCounter",Se),qe()):10==Se&&(console.log("10count",Se),qe(),x.value=1)}),1e3)},Te=()=>{console.log("stopCounter------"),Ae&&(clearInterval(Ae),Ae=null,Se=0)},Ce=t(0),ke=t(!1),be=async()=>{if(console.log(999,"handleRecorder",ke.value,ge.value,U.value),U.value&&!ge.value)return ke.value?qe():void(ke.value||(U.value=await P(A.isAudioInputAvailable),await P(A.stopPlayTextAudio),U.value&&(console.log("startRecorder-------"),await P(A.startRecorder),ke.value=!0,te.value="")))},Re=t(""),Le=async()=>{if(console.log("sendQuestion",M.value),0===M.value.trim().length||se.value)return void(M.value="");await P(A.stopPlayTextAudio),te.value="",ke.value&&qe(),Te(),re.value.push({role:"user",content:M.value});const{id:e,model:a,icon:l,llmname:t}=de.value,u=await P(A.sendAiRequest,e||"",a||"",1,M.value,2);re.value.push({role:"assistant",anwsers:[{content:"",talkID:u,status:0,type:0,llmIcon:l,llmName:t}]}),Re.value=u,ge.value=!0,M.value="",6!==x.value&&10!==x.value&&(x.value=3)},Pe=e=>{if(!O.value)if(console.log("activeFun",x.value,e),2==x.value||7==x.value){if(e&&0!==M.value.trim().length)return void qe();qe(),x.value=1}else 3==x.value?(Oe(),x.value=1):4==x.value?(x.value=1,Ee()):1!=x.value&&9!=x.value||(x.value=2,ke.value=!1)},Ie=()=>{if(2==x.value)ue.value=!0,0===M.value.trim().length?(ke.value=!1,P(A.stopRecorder),Te(),D.push("/chat")):qe();else{if(3==x.value||4==x.value)return;Te(),D.push("/chat")}},De=async e=>{const{content:a,talkID:l}=b.last(re.value).anwsers[0];await P(A.playTextAudio,l,e||a,!0),te.value=l},Ee=async()=>{await P(A.stopPlayTextAudio),te.value=""},qe=async(e,a)=>{console.log("sigAudioASRError",e,a),ke.value=!1,await P(A.stopRecorder),e&&ue.value&&D.push("/chat"),e&&6!==x.value&&(x.value=9,pe.value=a)},xe=e=>{console.log("sigPlayTTSFinished",e),te.value===e&&(te.value=""),5!==x.value&&6!==x.value&&8!==x.value&&9!==x.value&&(x.value=1),ge.value=!1},Oe=async()=>{await P(A.cancelAiRequest,Re.value);const e=re.value[re.value.length-2].content,{type:a,content:l}=b.last(b.last(re.value).anwsers),{icon:t,displayname:u}=de.value;P(A.logAiChatRecord,Re.value,e,l,!1,0,"",a,t||"",u||""),ge.value=!1,Te()};s((()=>x.value),(e=>{oe.value=e,console.log("watch",e),1==e?(A&&A.playSystemSound&&P(A.playSystemSound,1),Ee(),Te(),ge.value=!1):2==e?(A&&A.playSystemSound&&P(A.playSystemSound,0),ge.value=!1,ke.value=!1,be(),fe()):Te(),4==e&&se.value&&Ee(),5==e||6==e||8==e||10==e?(document.querySelector(".video5")&&(document.querySelector(".video5").currentTime=0,document.querySelector(".video5").play()),O.value=!0):9==e?(document.querySelector(".video5")&&(document.querySelector(".video5").currentTime=0,document.querySelector(".video5").play()),O.value=!1):(document.querySelector(".video5")&&document.querySelector(".video5").pause(),O.value=!1)}),{deep:!0,immediate:!1});const Me={sigAiReplyStream:(e,a,l)=>{if(console.log({type:e,value:a,status:l}),0===l?b.last(b.last(re.value).anwsers).content=b.last(b.last(re.value).anwsers).content+a:200===l?(b.last(b.last(re.value).anwsers).status=l,De(),6!==x.value&&10!==x.value&&(x.value=4)):(b.last(b.last(re.value).anwsers).content=a,b.last(re.value).status=l,b.last(b.last(re.value).anwsers).status=l),0!==l){const e=re.value[re.value.length-2].content,{type:a,content:t}=b.last(b.last(re.value).anwsers);l<0&&(-9002===l||-9e3===l||-9001===l?(pe.value=t,x.value=8):x.value=4,De());const{icon:u,displayname:s}=de.value;P(A.logAiChatRecord,Re.value,e,t,!1,l,"",a,u||"",s||"")}},sigAudioASRStream:(e,a)=>{console.log("sigAudioASRStream",e,a),M.value=e,""!==e&&(Te(),2==x.value&&fe()),a&&ue.value?(Te(),D.push("/chat")):a&&1!==x.value&&10!==x.value&&Le()},sigAudioASRError:qe,sigAudioCountDown:e=>{Ce.value=e,Ce.value>0?x.value=7:qe()},sigPlayTTSFinished:xe,sigPlayTTSError:e=>te.value="",sigActiveColorChanged:e=>f(e),sigAudioInputDevChange:e=>{console.log("sigAudioInputDevChange"),U.value=e,e||(ke.value=!1),e?le.value?x.value=1:x.value=10:x.value=6},sigAudioSampleLevel:e=>{const a=1+e/100*.7,l=1+e/100*1.2;E.value=a,q.value=l},sigNetStateChanged:e=>{e?x.value=1:(2==x.value&&qe(),3==x.value&&Oe(),4==x.value&&Ee(),x.value=5)},sigText2PicFinish:(e,a)=>{b.last(b.last(re.value).anwsers).content=JSON.stringify(a);const l=re.value[re.value.length-2].content,t=b.last(b.last(re.value).anwsers).type,u=b.last(b.last(re.value).anwsers).status;console.log(Re.value,l,a,0,"",t,u);const{icon:s,displayname:o}=de.value;P(A.logAiChatRecord,Re.value,l,JSON.stringify(a),!1,0,"",t,s||"",o||""),ge.value=!1,u>=0&&2===t&&a&&(De(L().loadTranslations["The picture has been generated, please switch to the chat interface to view it."]),6!==x.value&&10!==x.value&&(x.value=4))},sigChatConversationType:(e,a)=>{b.last(b.last(re.value).anwsers).type=a},sigWebchat2BeHiden:()=>{se.value=!0,2==x.value&&(qe(),x.value=1),4==x.value&&Ee()},sigWebchat2BeShowed:async()=>{se.value=!1,1==x.value&&(x.value=2),4==x.value&&(xe(),x.value=2)},sigThemeChanged:e=>{R(e)},llmAccountLstChanged:(e,a)=>{console.log(6555,e,a);const l=JSON.parse(a),t=l.findIndex((e=>e.id===de.value.id));e!==de.value.id&&0!==l.length&&5!==x.value&&6!==x.value&&(x.value=1),e||(de.value={}),t>-1?(l[t].active=!0,de.value=l[t]):l.forEach((a=>{a.id===e&&(a.active=!0,de.value=a)})),ce.value=l},sigDigitalModeActive:()=>{1==x.value&&(x.value=2)},sigAudioOutputDevChanged:async e=>{le.value=e,e?U.value?x.value=1:x.value=6:(te.value="",2==x.value||7==x.value?await P(A.stopRecorder):3==x.value?Oe():4==x.value&&Ee(),x.value=10)},sigWebchatModalityChanged:e=>(e=>{let a=document.querySelector("#drop-mask");a||(a=document.createElement("div"),a.id="drop-mask",document.body.appendChild(a)),a.style.height="100vh",a.style.width="100vw",a.style.display=e?"flex":"none"})(e)};function Ue(e){"Enter"===e.key&&(e.stopPropagation(),e.preventDefault(),console.log("handleEnterKey",M.value),0!==M.value.trim().length&&qe())}return o((async()=>{for(const e in Me)Object.hasOwnProperty.call(Me,e)&&A[e].connect(Me[e]);document.addEventListener("keydown",Ue),(async()=>{const e=await P(A.getAiChatRecords,!1),a=await P(A.queryLLMAccountList),l=await P(A.currentLLMAccountId);U.value=await P(A.isAudioInputAvailable),le.value=await P(A.isAudioOutputAvailable),re.value=JSON.parse(e);const t=await P(A.isNetworkAvailable);if(a){const e=JSON.parse(a);e.forEach((e=>{e.id===l&&(e.active=!0,de.value=e)})),ce.value=e}t?U.value?le.value?(A.playSystemSound&&P(A.playSystemSound,0),be(),fe()):x.value=10:x.value=6:x.value=5})(),L().loadTranslations=await P(A.loadTranslations)})),n((()=>{for(const e in Me)Object.hasOwnProperty.call(Me,e)&&A[e].disconnect(Me[e]);document.removeEventListener("keydown",Ue)})),(e,a)=>{const l=T;return v(),i("div",{class:"main-content",style:S({"--scale":E.value,"--scale1":q.value})},[r(C,{historyLength:re.value.length,playAudioID:te.value,"onUpdate:playAudioID":a[0]||(a[0]=e=>te.value=e),recording:ke.value,showStop:ge.value,videoStatus:x.value,localmodel:1e3===de.value.model,onSigAudioASRError:qe,onRouteJump:Ie},null,8,["historyLength","playAudioID","recording","showStop","videoStatus","localmodel"]),c("div",N,[j,c("div",{class:d(["animate-box",{disabledDig:O.value}]),onClick:a[11]||(a[11]=e=>Pe(!0))},[se.value?y("",!0):p((v(),i("video",{key:0,autoplay:"",loop:"",muted:"",class:"video1",onPlay:a[1]||(a[1]=e=>1==oe.value&&!se.value),onPause:a[2]||(a[2]=e=>1!==oe.value||se.value)},B,544)),[[g,1==x.value]]),p(c("div",J,F,512),[[g,2==x.value||7==x.value]]),se.value?y("",!0):p((v(),i("video",{key:1,autoplay:"",loop:"",muted:"",class:"video2",onPlay:a[3]||(a[3]=e=>!se.value&&(2==oe.value||7==oe.value)),onPause:a[4]||(a[4]=e=>2!==oe.value&&7!==oe.value||se.value)},W,544)),[[g,2==x.value||7==x.value]]),se.value?y("",!0):p((v(),i("video",{key:2,autoplay:"",loop:"",muted:"",class:"video3",onPlay:a[5]||(a[5]=e=>3==oe.value&&!se.value),onPause:a[6]||(a[6]=e=>3!==oe.value||se.value)},_,544)),[[g,3==x.value]]),se.value?y("",!0):p((v(),i("video",{key:3,autoplay:"",loop:"",muted:"",class:"video4",onPlay:a[7]||(a[7]=e=>4==oe.value&&!se.value),onPause:a[8]||(a[8]=e=>4!==oe.value||se.value)},Q,544)),[[g,4==x.value]]),se.value?y("",!0):p((v(),i("video",{key:4,autoplay:"",muted:"",class:"video5",onPlay:a[9]||(a[9]=e=>!se.value&&(5==oe.value||6==oe.value||8==oe.value||9==oe.value||10==oe.value)),onPause:a[10]||(a[10]=e=>5!==oe.value&&6!==oe.value&&8!==oe.value&&9!==oe.value&&10!==oe.value||se.value)},G,544)),[[g,5==x.value||6==x.value||8==x.value||9==x.value||10==x.value]])],2)]),c("div",z,[c("div",H,[8==x.value?(v(),i("pre",K,[m(h(w(ie)),1),c("span",{class:"go-config",href:"#",onClick:a[12]||(a[12]=e=>w(P)(w(A).launchLLMConfigWindow,!0))}," "+h(w(I).loadTranslations["Go to configuration"])+" >",1)],512)):(v(),i("div",$,[p(r(l,{icon:"voice"},null,512),[[g,2==x.value]]),m(h(Array.isArray(w(ie))?w(ie)[0]:w(ie))+" ",1),p(c("span",V,"...",512),[[g,1==x.value||2==x.value||3==x.value||4==x.value]]),Array.isArray(w(ie))?(v(),i("div",X,h(w(ie)[1]),1)):y("",!0)]))]),2==x.value||3==x.value||4==x.value||7==x.value?(v(),i("div",{key:0,class:d(["handel",{disabledDig:O.value}]),onMouseenter:a[13]||(a[13]=e=>he()),onMouseleave:a[14]||(a[14]=e=>we()),onClick:a[15]||(a[15]=e=>Pe())},[c("div",Y,[r(l,{icon:"dig-stop"})]),Z,p(r(k,{tip:w(ne),class:d(ve.value)},null,8,["tip","class"]),[[g,ye.value]])],34)):(v(),i("div",{key:1,class:d(["handel",{disabledDig:O.value}]),onClick:a[16]||(a[16]=e=>Pe()),onMouseenter:a[17]||(a[17]=e=>he()),onMouseleave:a[18]||(a[18]=e=>we())},[c("div",ee,[r(l,{icon:"dig-play"})]),ae,p(r(k,{tip:w(ne),class:d(ve.value)},null,8,["tip","class"]),[[g,ye.value]])],34))])],4)}}},[["__scopeId","data-v-2e160273"]]);export{le as default};
